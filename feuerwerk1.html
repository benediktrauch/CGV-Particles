<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>CGV-Aufgabe 1</title>
    <script src="babylon.js"></script>
    <script src="hand.js"></script>
    <style type="text/css">
        html, body, canvas {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
<canvas id="renderCanvas"></canvas>
<script>
    // Check support
    if (!BABYLON.Engine.isSupported()) {
        window.alert('Browser not supported');
    } else {
        var d = new Date();
        var startTime = d.getTime();
        var vector = 0;

        var randX = 0;
        var randY = 0;

        function getRandomArbitrary(min, max) {
            return Math.random() * (max - min);
        }

        var canvas = document.getElementById("renderCanvas");
        var engine = new BABYLON.Engine(canvas, true);

        var scene = new BABYLON.Scene(engine);
        var camera = new BABYLON.ArcRotateCamera("ArcRotateCamera", Math.PI / 2.0, 0.0, 20, new BABYLON.Vector3(0, 0, 0), scene);

        var rocket1 = BABYLON.Mesh.CreateBox("rocket1", 0.001, scene);
        var rocketParticleSystem = new BABYLON.ParticleSystem("particles", 2000, scene);
        rocketParticleSystem.particleTexture = new BABYLON.Texture("Flare.png", scene);

        var explosion1 = BABYLON.Mesh.CreateBox("explosion1", 0.001, scene);
        var explosionParticleSystem = new BABYLON.ParticleSystem("particles", 2000, scene);
        explosionParticleSystem.particleTexture = new BABYLON.Texture("Flare.png", scene);
        explosionParticleSystem.emitter = explosion1; // the starting object, the emitter



        randX = getRandomArbitrary(0, 2);
        randY = getRandomArbitrary(0, 2);

        // Where the particles comes from
        scene.beforeRender = function () {
            var d = new Date();
            var time = d.getTime();        // get milliseconds since 1970
            var elapsed_t = time - startTime;   // milliseconds since start


            vector = elapsed_t / 250;


            rocketParticleSystem.emitter = rocket1; // the starting object, the emitter
            rocketParticleSystem.minEmitBox = new BABYLON.Vector3(-0.01, -0.01, -vector); // Starting all From
            rocketParticleSystem.maxEmitBox = new BABYLON.Vector3(0.01, 0.01, -vector + 0.01); // To...

            rocketParticleSystem.emitRate = 10 * vector * vector;

            explosionParticleSystem.minEmitBox = new BABYLON.Vector3(-0.01, -0.01, -14); // Starting all From
            explosionParticleSystem.maxEmitBox = new BABYLON.Vector3(0.01, 0.01, -14 + 0.01); // To...


        }
        rocketParticleSystem.color1 = new BABYLON.Color4(0.8, 0.3, 0.3, 1);
        rocketParticleSystem.color2 = new BABYLON.Color4(0.9, 0.5, 0.5, 1);
        rocketParticleSystem.colorDead = new BABYLON.Color4(0.5, 0, 0, 0.1);

        rocketParticleSystem.minSize = 0.1;
        rocketParticleSystem.maxSize = 0.3;

        rocketParticleSystem.minLifeTime = 0.1;
        rocketParticleSystem.maxLifeTime = 1.0;


        rocketParticleSystem.blendMode = BABYLON.ParticleSystem.BLENDMODE_ONEONE;

        rocketParticleSystem.direction1 = new BABYLON.Vector3(0.1, 0.1, 1);
        rocketParticleSystem.direction2 = new BABYLON.Vector3(-0.1, -0.1, 1);

        rocketParticleSystem.gravity = new BABYLON.Vector3(0, 0, 1);

        rocketParticleSystem.minAngularSpeed = 0;
        rocketParticleSystem.maxAngularSpeed = 0;

        rocketParticleSystem.minEmitPower = 1;
        rocketParticleSystem.maxEmitPower = 2;

        rocketParticleSystem.updateSpeed = 0.01;

        rocketParticleSystem.targetStopDuration = 2;
        rocketParticleSystem.disposeOnStop = false;


        explosionParticleSystem.emitRate = 2500;


        explosionParticleSystem.color1 = new BABYLON.Color4(
            getRandomArbitrary(0, 100) / 100,
            getRandomArbitrary(0, 100) / 100,
            getRandomArbitrary(0, 100) / 100, 1);
        explosionParticleSystem.color2 = new BABYLON.Color4(
            getRandomArbitrary(0, 100) / 100,
            getRandomArbitrary(0, 100) / 100,
            getRandomArbitrary(0, 100) / 100, 1);
        explosionParticleSystem.colorDead = new BABYLON.Color4(
            getRandomArbitrary(0, 100) / 100 - getRandomArbitrary(0, 100) / 100,
            getRandomArbitrary(0, 100) / 100 - getRandomArbitrary(0, 100) / 100,
            getRandomArbitrary(0, 100) / 100 - getRandomArbitrary(0, 100) / 100, 0.3);

        explosionParticleSystem.minSize = 0.1;
        explosionParticleSystem.maxSize = 0.3;

        explosionParticleSystem.minLifeTime = 0.1;
        explosionParticleSystem.maxLifeTime = 3.0;


        explosionParticleSystem.blendMode = BABYLON.ParticleSystem.BLENDMODE_ONEONE;

        explosionParticleSystem.direction1 = new BABYLON.Vector3(1, 1, 0.5);
        explosionParticleSystem.direction2 = new BABYLON.Vector3(-1, -1, -0.8);

        explosionParticleSystem.gravity = new BABYLON.Vector3(0, 0, 10);

        explosionParticleSystem.minAngularSpeed = 0;
        explosionParticleSystem.maxAngularSpeed = 0;

        explosionParticleSystem.minEmitPower = 5;
        explosionParticleSystem.maxEmitPower = 10;

        explosionParticleSystem.updateSpeed = 0.01;

        explosionParticleSystem.targetStopDuration = 0.1;
        explosionParticleSystem.disposeOnStop = false;


        rocketParticleSystem.start();

        var box = BABYLON.Mesh.CreateBox("Box", 0.3, scene);

        box.material = new BABYLON.StandardMaterial("groundMat", scene);
        box.material.backFaceCulling = false;
        box.material.emissiveColor = new BABYLON.Color3(0.5, 0.2, 0.2);

        scene.activeCamera.attachControl(canvas);

        // Render loop
        var renderLoop = function () {
            // Start new frame
            engine.beginFrame();

            scene.render();

            // Present
            engine.endFrame();

            // Register new frame
            BABYLON.Tools.QueueNewFrame(renderLoop);
        };
        BABYLON.Tools.QueueNewFrame(renderLoop);

        // Resize
        window.addEventListener("resize", function () {
            engine.resize();
        });
    }
    ;

</script>
</body>
</html>
